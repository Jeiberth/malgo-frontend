import{_ as U,r as d,h as M,c as l,b as F,a as t,e as J,F as p,d as f,t as a,w as T,f as V,n as h,j as Q,o as n,i as W}from"./index-7qXWaERP.js";import{S as D}from"./sweetalert2.esm.all-BU56eIIa.js";import{t as X}from"./billPaymentApi-B3uuz4KV.js";import"./axios-h6TTGGbn.js";const Y={class:"container"},Z={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},tt={class:"modal-content",style:{"max-width":"900px"}},et={class:"modal-body p-4",style:{"overflow-y":"auto"}},st={class:"row"},ot={class:"col-md-6"},lt={class:"seccion",style:{height:"100%","padding-bottom":"0px"}},at={class:"contenedor-campos",style:{gap:"10px !important"}},nt={style:{"overflow-x":"auto"}},rt={class:"table table-striped custom-border-table",style:{"border-radius":"25px",overflow:"hidden"}},it={class:"col-md-6"},dt={class:"seccion",style:{height:"100%"}},ut={class:"contenedor-campos",style:{height:"calc(100% - 60px)"}},ct={class:"grupo-campos",style:{height:"100%"}},mt=["src"],pt={class:"modal-footer"},ft=["disabled"],vt={class:"row seccion mainSeccion mt-4"},ht={class:"col-12 mb-4"},bt={class:"row"},yt={class:"col-md-6 mb-3"},gt=["value"],_t={class:"col-md-6 mb-3"},kt=["value"],Mt={class:"col-12"},wt={style:{"overflow-x":"auto"}},Pt={class:"table table-bordered table-hover table-striped align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},St=["onClick"],xt={class:"col-12 mt-3"},Ct={class:"pagination"},At=["onClick"],O=10,Ft={__name:"payments",setup(Dt){Q();const I=new X,v=d((()=>{const o=[],e=["verified","pending"],s=["Bank Transfer","Credit Card","Cash","PayPal"],r=["FO-APTO-201","SE-APTO-301","FO-PARQ-1","SE-LOC-1"],k=["Agua","Luz","Gas","Arriendo"];for(let m=1;m<=25;m++){const R=Math.floor(Math.random()*3)+1,A=[];for(let i=0;i<R;i++)A.push({id:m*10+i,payment_id:m,bill_id:m*10+i,bills:{id:m*10+i,bill_type_id:i+1,property_id:Math.floor(Math.random()*4)+1,start_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-01`,end_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-28`,due_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-15`,amount:(Math.random()*1e6+5e5).toFixed(2),status:"paid",property:{id:Math.floor(Math.random()*4)+1,sku:r[Math.floor(Math.random()*r.length)]},bill_types:{id:i+1,name:k[Math.floor(Math.random()*k.length)]}}});o.push({id:m,amount:A.reduce((i,K)=>i+parseFloat(K.bills.amount),0).toFixed(2),payment_method:s[Math.floor(Math.random()*s.length)],status:e[Math.floor(Math.random()*2)],payment_cert:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTr_Gc86Sq0aRtKyv2gCjyvIpKWsuJHbb9_TA&s",paid_at:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}T${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}:00`,verified_at:null,payment_has_bills:A})}return o})()),w=d(!1),b=d(!1),y=d(""),g=d(""),u=d(1),$=M(()=>v.value.filter(o=>{const e=!y.value||o.payment_has_bills.some(r=>r.bills.property.sku===y.value),s=!g.value||(g.value==="verified"?o.status==="verified":o.status==="pending");return e&&s})),_=M(()=>Math.ceil($.value.length/O)),N=M(()=>{const o=(u.value-1)*O;return $.value.slice(o,o+O)}),B=M(()=>{const o=new Set;return v.value.forEach(e=>{e.payment_has_bills.forEach(s=>{o.add(s.bills.property.sku)})}),Array.from(o)}),L=["verified","pending"],P=d(!1),c=d(null),j=o=>{c.value=o,P.value=!0},S=()=>{P.value=!1,c.value=null},z=async()=>{b.value=!0,w.value=!0,await I.verifyPayment({id:c.value.id}).then(o=>{if(o&&o.success){const e=v.value.findIndex(s=>s.id===c.value.id);e!==-1&&(v.value[e].status="verified",v.value[e].verified_at=new Date().toISOString()),D.fire("Ã‰xito","El pago fue verificado exitosamente.","success")}else D.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{console.log(o),D.fire("Error","Hubo un error, intenta despues.","error")}),b.value=!1,w.value=!1},E=o=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(o),x=o=>{if(!o)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString("es-CO",e)},G=o=>{if(!o)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(o).toLocaleDateString("es-CO",e)},H=o=>({verified:"bg-verified",pending:"bg-pending"})[o],q=o=>{switch(o){case"Agua":return"fa-solid fa-bottle-water";case"Gas":return"fa-solid fa-gas-pump";case"Luz":return"fa-solid fa-bolt";case"Arriendo":return"fa-solid fa-house-user";default:return""}},C=o=>{o>=1&&o<=_.value&&(u.value=o)};return(o,e)=>(n(),l("div",Y,[w.value?(n(),l("div",Z,e[4]||(e[4]=[t("div",{class:"spinner-border text-light",role:"status"},[t("span",{class:"visually-hidden"})],-1)]))):F("",!0),P.value?(n(),l("div",{key:1,class:"modal",onClick:J(S,["self"])},[t("div",tt,[t("div",{class:"modal-header"},[e[5]||(e[5]=t("span",{class:"modal-title"},"ðŸ“„ Detalles del Pago",-1)),t("button",{class:"close-button",onClick:S},"Ã—")]),t("div",et,[t("div",st,[t("div",ot,[t("div",lt,[e[12]||(e[12]=t("h3",{class:"titulo-seccion"},"ðŸ“‹ Facturas Pagadas",-1)),t("div",at,[(n(!0),l(p,null,f(c.value.payment_has_bills,(s,r)=>(n(),l("div",{key:r,class:"grupo-campos"},[t("div",nt,[t("table",rt,[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("th",{style:{width:"40%"}},"Nombre",-1)),t("td",null,a(s.bills.bill_types.name),1)]),t("tr",null,[e[7]||(e[7]=t("th",null,"Inmueble",-1)),t("td",null,a(s.bills.property.sku),1)]),t("tr",null,[e[8]||(e[8]=t("th",null,"Desde",-1)),t("td",null,a(x(s.bills.start_date)),1)]),t("tr",null,[e[9]||(e[9]=t("th",null,"Hasta",-1)),t("td",null,a(x(s.bills.end_date)),1)]),t("tr",null,[e[10]||(e[10]=t("th",null,"Vence",-1)),t("td",null,a(x(s.bills.due_date)),1)]),t("tr",null,[e[11]||(e[11]=t("th",null,"Monto",-1)),t("td",null,a(E(s.bills.amount)),1)])])])])]))),128))])])]),t("div",it,[t("div",dt,[e[13]||(e[13]=t("h3",{class:"titulo-seccion"},"ðŸ“„ Comprobante de Pago",-1)),t("div",ut,[t("div",ct,[t("img",{src:c.value.payment_cert,alt:"Comprobante de pago",style:{width:"100%",height:"100%","object-fit":"contain",border:"0px solid #d7b377","border-radius":"15px"}},null,8,mt)])])])])]),t("div",pt,[t("button",{type:"button",class:"boton-secundario",onClick:S}," Cancelar "),c.value.status!=="verified"?(n(),l("button",{key:0,type:"button",class:"boton-primario",onClick:z,disabled:b.value,style:{width:"auto"}},a(b.value?"Verificando...":"Verificar"),9,ft)):F("",!0)])])])])):F("",!0),t("div",vt,[e[21]||(e[21]=t("div",{class:"col-12"},[t("h2",{class:"titulo-seccion"},"ðŸ’µ Pagos")],-1)),t("div",ht,[t("div",bt,[t("div",yt,[T(t("select",{class:"entrada","onUpdate:modelValue":e[0]||(e[0]=s=>y.value=s),style:{"background-color":"#f8f5f0"}},[e[14]||(e[14]=t("option",{value:""},"Todos los Inmuebles",-1)),(n(!0),l(p,null,f(B.value,s=>(n(),l("option",{key:s,value:s},a(s),9,gt))),128))],512),[[V,y.value]])]),t("div",_t,[T(t("select",{class:"entrada","onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),style:{"background-color":"#f8f5f0"}},[e[15]||(e[15]=t("option",{value:""},"Todos los Estados",-1)),(n(),l(p,null,f(L,s=>t("option",{key:s,value:s},a(s),9,kt)),64))],512),[[V,g.value]])])])]),t("div",Mt,[t("div",wt,[t("table",Pt,[e[18]||(e[18]=t("thead",{style:{"background-color":"#8f754f",color:"white"}},[t("tr",null,[t("th",null,"PagÃ³"),t("th",null,"Monto"),t("th",null,"MÃ©todo de Pago"),t("th",null,"Estado"),t("th",null,"Pagado el"),t("th")])],-1)),t("tbody",null,[(n(!0),l(p,null,f(N.value,s=>(n(),l("tr",{key:s.id},[t("td",null,[(n(!0),l(p,null,f(s.payment_has_bills,(r,k)=>(n(),l("div",{key:k},[W(a(r.bills.property.sku)+" ",1),t("i",{class:h(q(r.bills.bill_types.name))},null,2),e[16]||(e[16]=t("br",null,null,-1))]))),128))]),t("td",null,a(E(s.amount)),1),t("td",null,a(s.payment_method),1),t("td",null,[t("span",{class:h(["badge",H(s.status)])},a(s.status==="verified"?"Verificado":"Pendiente"),3)]),t("td",null,a(G(s.paid_at)),1),t("td",null,[t("button",{class:"btn btn-sm",onClick:r=>j(s),style:{background:"none",border:"none"}},e[17]||(e[17]=[t("i",{class:"fas fa-info-circle",style:{color:"#8f754f","font-size":"1.2rem"}},null,-1)]),8,St)])]))),128))])])])]),t("div",xt,[t("nav",null,[t("ul",Ct,[t("li",{class:h(["page-item",{disabled:u.value===1}])},[t("a",{class:"page-link",onClick:e[2]||(e[2]=s=>C(u.value-1)),href:"#"},e[19]||(e[19]=[t("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(n(!0),l(p,null,f(_.value,s=>(n(),l("li",{class:h(["page-item",{active:u.value===s}]),key:s},[t("a",{class:"page-link",onClick:r=>C(s),href:"#"},a(s),9,At)],2))),128)),t("li",{class:h(["page-item",{disabled:u.value===_.value||_.value===0}])},[t("a",{class:"page-link",onClick:e[3]||(e[3]=s=>C(u.value+1)),href:"#"},e[20]||(e[20]=[t("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},It=U(Ft,[["__scopeId","data-v-36ce3f6d"]]);export{It as default};
