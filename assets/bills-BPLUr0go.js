import{_ as $,r as m,x as N,j,i as I,c as d,b as y,d as e,q as x,w as M,v as z,n as c,t as o,g as R,F as B,p as O,o as i,z as T}from"./index-Dk81lAei.js";import{S as g}from"./sweetalert2.esm.all-B0Dix5B2.js";import{b as L}from"./billPayment-4Z_SaEjl.js";const G={class:"container"},W={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},J={class:"modal-content",style:{"overflow-y":"auto",height:"auto","max-width":"880px"}},K={class:"modal-body p-4"},Q={class:"contenedor-campos",style:{gap:"10px !important"}},X={class:"grupo-campos"},Y={class:"campos-grid"},Z={class:"campo"},ee=["value"],te={class:"campo"},ae={key:0,class:"text-danger mt-1"},se={class:"campo"},oe={key:0,class:"text-danger mt-1"},le={class:"modal-footer"},ne=["disabled"],de={class:"row seccion mainSeccion mt-4"},ie={class:"col-12 d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4"},re=["disabled"],ue={class:"col-12"},ce={class:"d-none d-md-block",style:{"overflow-x":"auto"}},pe={class:"table table-bordered table-striped table-hover align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},me=["onClick"],ve=["value"],_e={key:0},ye={class:"d-md-none"},fe=["onClick"],ge={class:"card-header"},be=["value"],he={class:"card-title"},ke={class:"card-body"},xe={class:"card-row"},Pe={class:"card-value"},we={class:"card-row"},Ce={class:"card-value"},Me={class:"card-row"},Be={class:"card-value"},Oe={class:"card-row"},Se={class:"card-value"},Ve={key:0,class:"text-center py-4"},De={class:"col-12 mt-4"},Ee={class:"pagination"},Fe=["onClick"],S=10,Ne={__name:"bills",setup(Te){const V=I(),D=new L,f=m(!1),b=m(!1),P=m(!1),l=m([]),n=m([{id:21,bill_type_id:4,property_id:4,start_date:"2025-03-01",end_date:"2025-03-31",due_date:"2025-04-10",amount:"950000.00",status:"Atrasado",property:{id:4,sku:"FO-APTO-201"},bill_type:{id:4,name:"Agua"}},{id:22,bill_type_id:3,property_id:5,start_date:"2025-03-01",end_date:"2025-03-31",due_date:"2025-04-10",amount:"1200000.00",status:"Pendiente",property:{id:5,sku:"SE-APTO-301"},bill_type:{id:3,name:"Renta"}},{id:23,bill_type_id:2,property_id:4,start_date:"2025-04-01",end_date:"2025-04-30",due_date:"2025-05-10",amount:"850000.00",status:"Pagado",property:{id:4,sku:"FO-APTO-201"},bill_type:{id:2,name:"Renta"}}]),u=m({amount:0,payment_method:"",payment_proof:null}),r=m({}),v=m(1),h=N(()=>Math.ceil(n.value.length/S));N(()=>{const s=(v.value-1)*S;return n.value.slice(s,s+S)}),j(async()=>{f.value=!0,n.value=V.getters.getBillsUnpaid,n.value.length==0&&await D.getBillsUnpaid().then(s=>{s&&s.success?(n.value=s.data,V.commit("setBillsUnpaid",n.value)):g.fire("Error","Hubo un error, intenta despues.","error")}).catch(s=>{g.fire("Error","Hubo un error, intenta despues.","error")}),f.value=!1});const U=()=>{l.value.length!==0&&(u.value.amount=l.value.reduce((s,t)=>{const a=n.value.find(p=>p.id===t);return s+parseFloat(a.amount)},0),P.value=!0)},k=()=>{P.value=!1,u.value={amount:0,payment_method:"",payment_proof:null},r.value={}},q=s=>{const t=s.target.files[0];t&&t.type.startsWith("image/")?u.value.payment_proof=t:r.value.payment_proof="Solo se permiten imÃ¡genes"},A=()=>{r.value={};let s=!0;return u.value.payment_method||(r.value.payment_method="MÃ©todo de pago requerido",s=!1),u.value.payment_proof||(r.value.payment_proof="Comprobante de pago valido requerido",s=!1),s},H=async()=>{A()&&(b.value=!0,f.value=!0,await D.payBills({paymentData:u.value,billsPaid:l.value}).then(s=>{s.success?(n.value=n.value.filter(t=>!l.value.includes(t.id)),g.fire("Â¡Pago exitoso!","Gracias por su pago, se le notificara por via email cuando sea confirmado.","success")):g.fire("Error","Hubo un problema al procesar el pago. Por favor intente nuevamente.","error")}).catch(s=>{g.fire("Error","Hubo un problema al procesar el pago. Por favor intente nuevamente.","error")}),l.value=[],k(),b.value=!1,f.value=!1)},w=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(s),_=s=>{const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(s).toLocaleDateString("es-CO",t)},E=s=>{const t=l.value.indexOf(s);t===-1?l.value.push(s):l.value.splice(t,1)},F=s=>({Pendiente:"bg-pendiente",Pagado:"bg-pagado",Atrasado:"bg-vencido"})[s],C=s=>{s>=1&&s<=h.value&&(v.value=s)};return(s,t)=>(i(),d("div",G,[f.value?(i(),d("div",W,t[7]||(t[7]=[e("div",{class:"spinner-border text-light",role:"status"},[e("span",{class:"visually-hidden"})],-1)]))):y("",!0),P.value?(i(),d("div",{key:1,class:"modal",onClick:x(k,["self"])},[e("div",J,[e("div",{class:"modal-header"},[t[8]||(t[8]=e("span",{class:"modal-title"},"ðŸ’³ Confirmar Pago de Factura(s)",-1)),e("button",{class:"close-button",onClick:k},"Ã—")]),e("div",K,[e("form",{onSubmit:x(H,["prevent"])},[e("div",null,[e("div",Q,[e("div",X,[e("div",Y,[e("div",Z,[t[9]||(t[9]=e("label",{class:"etiqueta"},"Monto Total (COP)",-1)),e("input",{value:w(u.value.amount),type:"text",class:"entrada",disabled:""},null,8,ee)]),e("div",te,[t[10]||(t[10]=e("label",{class:"etiqueta"},"MÃ©todo de Pago",-1)),M(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>u.value.payment_method=a),type:"text",class:c(["entrada",{"is-invalid":r.value.payment_method}]),placeholder:"Ej: Transferencia Bancaria"},null,2),[[z,u.value.payment_method]]),r.value.payment_method?(i(),d("div",ae,o(r.value.payment_method),1)):y("",!0)]),e("div",se,[t[11]||(t[11]=e("label",{class:"etiqueta"},"Comprobante de Pago (Imagen)",-1)),e("input",{type:"file",onChange:q,accept:"image/*",class:c(["entrada",{"is-invalid":r.value.payment_proof}])},null,34),r.value.payment_proof?(i(),d("div",oe,o(r.value.payment_proof),1)):y("",!0)])])])])]),e("div",le,[e("button",{type:"button",class:"boton-secundario",onClick:k}," Cerrar "),e("button",{type:"submit",class:"boton-primario",disabled:b.value,style:{width:"auto"}},o(b.value?"Procesando...":"Pagar"),9,ne)])],32)])])])):y("",!0),e("div",de,[e("div",ie,[t[13]||(t[13]=e("h2",{class:"titulo-seccion mb-2 mb-md-0",style:{margin:"0"}},"ðŸ“„ Facturas",-1)),e("button",{class:"boton-primario mt-md-0 mt-2",onClick:U,style:{width:"auto"},disabled:l.value.length===0},t[12]||(t[12]=[e("i",{class:"fas fa-money-bill-wave",style:{"margin-right":"10px",width:"auto"}},null,-1),R(" Confirmar pago de factura ")]),8,re)]),e("div",ue,[e("div",ce,[e("table",pe,[t[15]||(t[15]=e("thead",{style:{"background-color":"#8f754f",color:"white"}},[e("tr",null,[e("th"),e("th",null,"Nombre"),e("th",null,"Inmueble"),e("th",null,"Desde"),e("th",null,"Hasta"),e("th",null,"Vence"),e("th",null,"Monto"),e("th",null,"Estado")])],-1)),e("tbody",null,[(i(!0),d(B,null,O(n.value,a=>(i(),d("tr",{key:a.id,onClick:p=>E(a.id),class:c({"selected-row":l.value.includes(a.id)})},[e("td",{onClick:t[2]||(t[2]=x(()=>{},["stop"]))},[M(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=p=>l.value=p),value:a.id,style:{height:"auto"}},null,8,ve),[[T,l.value]])]),e("td",null,o(a.bill_type.name),1),e("td",null,o(a.property.sku),1),e("td",null,o(_(a.start_date)),1),e("td",null,o(_(a.end_date)),1),e("td",null,o(_(a.due_date)),1),e("td",null,o(w(a.amount)),1),e("td",null,[e("span",{class:c(["badge",F(a.status)])},o(a.status),3)])],10,me))),128)),n.value.length===0?(i(),d("tr",_e,t[14]||(t[14]=[e("td",{colspan:"8",class:"text-center py-4"},"No hay facturas pendientes",-1)]))):y("",!0)])])]),e("div",ye,[(i(!0),d(B,null,O(n.value,a=>(i(),d("div",{class:c(["mobile-bill-card",{"selected-card":l.value.includes(a.id)}]),key:"mobile-"+a.id,onClick:p=>E(a.id)},[e("div",ge,[e("div",{class:"card-checkbox",onClick:t[4]||(t[4]=x(()=>{},["stop"]))},[M(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=p=>l.value=p),value:a.id},null,8,be),[[T,l.value]])]),e("div",he,[e("strong",null,o(a.bill_type.name),1),e("span",{class:c(["badge",F(a.status)])},o(a.status),3)])]),e("div",ke,[e("div",xe,[t[16]||(t[16]=e("span",{class:"card-label"},"Inmueble:",-1)),e("span",Pe,o(a.property.sku),1)]),e("div",we,[t[17]||(t[17]=e("span",{class:"card-label"},"Periodo:",-1)),e("span",Ce,o(_(a.start_date))+" - "+o(_(a.end_date)),1)]),e("div",Me,[t[18]||(t[18]=e("span",{class:"card-label"},"Vence:",-1)),e("span",Be,o(_(a.due_date)),1)]),e("div",Oe,[t[19]||(t[19]=e("span",{class:"card-label"},"Monto:",-1)),e("span",Se,o(w(a.amount)),1)])])],10,fe))),128)),n.value.length===0?(i(),d("div",Ve,"No hay facturas pendientes")):y("",!0)])]),e("div",De,[e("nav",null,[e("ul",Ee,[e("li",{class:c(["page-item",{disabled:v.value===1}])},[e("a",{class:"page-link",onClick:t[5]||(t[5]=a=>C(v.value-1)),href:"#"},t[20]||(t[20]=[e("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(i(!0),d(B,null,O(h.value,a=>(i(),d("li",{class:c(["page-item",{active:v.value===a}]),key:a},[e("a",{class:"page-link",onClick:p=>C(a),href:"#"},o(a),9,Fe)],2))),128)),e("li",{class:c(["page-item",{disabled:v.value===h.value||h.value===0}])},[e("a",{class:"page-link",onClick:t[6]||(t[6]=a=>C(v.value+1)),href:"#"},t[21]||(t[21]=[e("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},He=$(Ne,[["__scopeId","data-v-7bf1bcf9"]]);export{He as default};
