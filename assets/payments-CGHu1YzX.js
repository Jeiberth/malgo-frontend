import{_ as G,j as J,r,i as K,k as Q,m as N,c as l,b as w,d as t,s as W,F as f,q as p,w as C,g as A,t as a,x as B,n as g,B as X,o as n}from"./index-_3zNMmWh.js";import{S as c}from"./sweetalert2.esm.all-B0Dix5B2.js";import{b as Y}from"./billPayment-CWv1Hc3g.js";const Z={class:"container"},tt={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},et={class:"modal-content",style:{"max-width":"900px"}},st={class:"modal-body p-4",style:{"overflow-y":"auto"}},ot={class:"row"},lt={class:"col-md-6"},nt={class:"seccion",style:{height:"100%","padding-bottom":"0px"}},at={class:"contenedor-campos",style:{gap:"10px !important"}},rt={style:{"overflow-x":"auto"}},it={class:"table table-striped custom-border-table",style:{"border-radius":"25px",overflow:"hidden"}},ut={class:"col-md-6"},dt={class:"seccion",style:{height:"100%"}},ct={class:"contenedor-campos",style:{height:"calc(100% - 60px)"}},vt={class:"grupo-campos",style:{height:"100%"}},mt=["src"],ft={class:"modal-footer"},pt=["disabled"],yt={class:"row seccion mainSeccion mt-4"},bt={class:"col-12 mb-4"},gt={class:"row"},ht={class:"col-md-6 mb-3"},_t=["value"],kt={class:"col-md-6 mb-3"},Pt=["value"],wt={class:"col-12"},Ct={style:{"overflow-x":"auto"}},xt={class:"table table-bordered table-hover table-striped align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},Dt=["onClick"],Et={key:0},Mt={class:"col-12 mt-3"},St={class:"pagination"},Nt=["onClick"],H=10,Ht={__name:"payments",setup(Ft){const z=new Q,y=K(),F=new Y;J(async()=>{b.value=!0,i.value=y.getters.getPayments,i.value.length==0&&await F.getPayments().then(s=>{s&&s.success?(i.value=s.data,y.commit("setPayments",i.value)):c.fire("Error","Hubo un error, intenta despues.","error")}).catch(s=>{c.fire("Error","Hubo un error, intenta despues.","error")}),x.value=y.getters.getProperties,x.value.length==0&&y.getters.userRole=="admin"&&await z.getAllProperties().then(s=>{s&&s.success?y.commit("setProperties",s.data):c.fire("Error","Hubo un error, intenta de nuevo","error")}).catch(s=>{c.fire("Error","Hubo un error, intenta de nuevo","error")}),b.value=!1});const x=r(),i=r(),b=r(!1),h=r(!1),_=r(""),k=r(""),u=r(1),I=N(()=>i.value.filter(s=>{const e=!_.value||s.payment_has_bills.some(o=>bills.property.sku===_.value),v=!k.value||(k.value==="Confirmado"?s.status==="Confirmado":s.status==="Pendiente");return e&&v})),P=N(()=>Math.ceil(I.value.length/H)),O=N(()=>{const s=(u.value-1)*H;return I.value.slice(s,s+H)}),L=["Confirmado","Pendiente"],D=r(!1),d=r(null),$=s=>{d.value=s,D.value=!0},E=()=>{D.value=!1,d.value=null},j=async()=>{h.value=!0,b.value=!0,await F.verifyPayment({id:d.value.id}).then(s=>{if(s&&s.success){const e=i.value.findIndex(v=>v.id===d.value.id);e!==-1&&(i.value[e].status="Confirmado",i.value[e].verified_at=new Date().toISOString()),c.fire("Ã‰xito","El pago fue Confirmado exitosamente.","success")}else c.fire("Error","Hubo un error, intenta despues.","error")}).catch(s=>{c.fire("Error","Hubo un error, intenta despues.","error")}),h.value=!1,b.value=!1},V=s=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(s),M=s=>{if(!s)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(s).toLocaleDateString("es-CO",e)},R=s=>{if(!s)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(s).toLocaleDateString("es-CO",e)},T=s=>({Confirmado:"bg-verified",Pendiente:"bg-pending"})[s],U=s=>{switch(s){case"Agua":return"fa-solid fa-bottle-water";case"Gas":return"fa-solid fa-gas-pump";case"Luz":return"fa-solid fa-bolt";case"Arriendo":return"fa-solid fa-house-user";default:return""}},S=s=>{s>=1&&s<=P.value&&(u.value=s)};return(s,e)=>{const v=X("admin-only");return n(),l("div",Z,[b.value?(n(),l("div",tt,e[4]||(e[4]=[t("div",{class:"spinner-border text-light",role:"status"},[t("span",{class:"visually-hidden"})],-1)]))):w("",!0),D.value?(n(),l("div",{key:1,class:"modal",onClick:W(E,["self"])},[t("div",et,[t("div",{class:"modal-header"},[e[5]||(e[5]=t("span",{class:"modal-title"},"ðŸ“„ Detalles del Pago",-1)),t("button",{class:"close-button",onClick:E},"Ã—")]),t("div",st,[t("div",ot,[t("div",lt,[t("div",nt,[e[12]||(e[12]=t("h3",{class:"titulo-seccion"},"ðŸ“‹ Facturas Pagadas",-1)),t("div",at,[(n(!0),l(f,null,p(d.value.bills,(o,m)=>(n(),l("div",{key:m,class:"grupo-campos"},[t("div",rt,[t("table",it,[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("th",{style:{width:"40%"}},"Nombre",-1)),t("td",null,a(o.bill_type.name),1)]),t("tr",null,[e[7]||(e[7]=t("th",null,"Inmueble",-1)),t("td",null,a(o.property.sku),1)]),t("tr",null,[e[8]||(e[8]=t("th",null,"Desde",-1)),t("td",null,a(M(o.start_date)),1)]),t("tr",null,[e[9]||(e[9]=t("th",null,"Hasta",-1)),t("td",null,a(M(o.end_date)),1)]),t("tr",null,[e[10]||(e[10]=t("th",null,"Vence",-1)),t("td",null,a(M(o.due_date)),1)]),t("tr",null,[e[11]||(e[11]=t("th",null,"Monto",-1)),t("td",null,a(V(o.amount)),1)])])])])]))),128))])])]),t("div",ut,[t("div",dt,[e[13]||(e[13]=t("h3",{class:"titulo-seccion"},"ðŸ“„ Comprobante de Pago",-1)),t("div",ct,[t("div",vt,[t("img",{src:d.value.payment_cert_url,alt:"Comprobante de pago",style:{width:"100%",height:"100%","object-fit":"contain",border:"0px solid #d7b377","border-radius":"15px"}},null,8,mt)])])])])]),t("div",ft,[t("button",{type:"button",class:"boton-secundario",onClick:E}," Cancelar "),d.value.status!=="Confirmado"?C((n(),l("button",{key:0,type:"button",class:"boton-primario",onClick:j,disabled:h.value,style:{width:"auto"}},[A(a(h.value?"Confirmando...":"Confirmar"),1)],8,pt)),[[v]]):w("",!0)])])])])):w("",!0),t("div",yt,[e[22]||(e[22]=t("div",{class:"col-12"},[t("h2",{class:"titulo-seccion"},"ðŸ’µ Pagos")],-1)),C((n(),l("div",bt,[t("div",gt,[t("div",ht,[C(t("select",{class:"entrada","onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),style:{"background-color":"#f8f5f0"}},[e[14]||(e[14]=t("option",{value:""},"Todas las Propiedades",-1)),(n(!0),l(f,null,p(x.value,o=>(n(),l("option",{key:o,value:o.sku},a(o.sku),9,_t))),128))],512),[[B,_.value]])]),t("div",kt,[C(t("select",{class:"entrada","onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),style:{"background-color":"#f8f5f0"}},[e[15]||(e[15]=t("option",{value:""},"Todos los Estados",-1)),(n(),l(f,null,p(L,o=>t("option",{key:o,value:o},a(o),9,Pt)),64))],512),[[B,k.value]])])])])),[[v]]),t("div",wt,[t("div",Ct,[t("table",xt,[e[19]||(e[19]=t("thead",{style:{"background-color":"#8f754f",color:"white"}},[t("tr",null,[t("th",null,"PagÃ³"),t("th",null,"Monto"),t("th",null,"MÃ©todo de Pago"),t("th",null,"Estado"),t("th",null,"Pagado el"),t("th")])],-1)),t("tbody",null,[(n(!0),l(f,null,p(O.value,o=>(n(),l("tr",{key:o.id},[t("td",null,[(n(!0),l(f,null,p(o.bills,(m,q)=>(n(),l("div",{key:q},[A(a(m.property.sku)+" ",1),t("i",{class:g(U(m.bill_type.name))},null,2),e[16]||(e[16]=t("br",null,null,-1))]))),128))]),t("td",null,a(V(o.amount)),1),t("td",null,a(o.payment_method),1),t("td",null,[t("span",{class:g(["badge",T(o.status)])},a(o.status==="Confirmado"?"Confirmado":"Pendiente"),3)]),t("td",null,a(R(o.paid_at)),1),t("td",null,[t("button",{class:"btn btn-sm",onClick:m=>$(o),style:{background:"none",border:"none"}},e[17]||(e[17]=[t("i",{class:"fas fa-info-circle",style:{color:"#8f754f","font-size":"1.2rem"}},null,-1)]),8,Dt)])]))),128)),O.value.length===0?(n(),l("tr",Et,e[18]||(e[18]=[t("td",{colspan:"6",class:"text-center py-4"},"No hay pagos todavia",-1)]))):w("",!0)])])])]),t("div",Mt,[t("nav",null,[t("ul",St,[t("li",{class:g(["page-item",{disabled:u.value===1}])},[t("a",{class:"page-link",onClick:e[2]||(e[2]=o=>S(u.value-1)),href:"#"},e[20]||(e[20]=[t("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(n(!0),l(f,null,p(P.value,o=>(n(),l("li",{class:g(["page-item",{active:u.value===o}]),key:o},[t("a",{class:"page-link",onClick:m=>S(o),href:"#"},a(o),9,Nt)],2))),128)),t("li",{class:g(["page-item",{disabled:u.value===P.value||P.value===0}])},[t("a",{class:"page-link",onClick:e[3]||(e[3]=o=>S(u.value+1)),href:"#"},e[21]||(e[21]=[t("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])])}}},At=G(Ht,[["__scopeId","data-v-5d6cbd71"]]);export{At as default};
