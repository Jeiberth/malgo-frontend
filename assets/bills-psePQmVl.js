import{_ as A,r as d,h as M,c as n,b as g,a as e,e as F,w as O,v as E,n as m,t as l,i as N,F as D,d as S,j as I,o as i,l as H}from"./index-DmAJTVfG.js";import{S as x}from"./sweetalert2.esm.all-BU56eIIa.js";import{t as L}from"./billPaymentApi-CXHAjPUZ.js";import"./axios-Cr2geZcp.js";const R={class:"container"},U={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},$={class:"modal-content",style:{"overflow-y":"auto",height:"auto","max-width":"880px"}},z={class:"modal-body p-4"},W={class:"contenedor-campos",style:{gap:"10px !important"}},G={class:"grupo-campos"},J={class:"campos-grid"},K={class:"campo"},Q=["value"],X={class:"campo"},Y={key:0,class:"text-danger mt-1"},Z={class:"campo"},ee={key:0,class:"text-danger mt-1"},te={class:"modal-footer"},ae=["disabled"],se={class:"row seccion mt-4"},oe={class:"col-12 d-flex justify-content-between align-items-center mb-4"},le=["disabled"],ne={class:"col-12"},ie={style:{"overflow-x":"auto"}},re={class:"table table-bordered table-striped table-hover align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},de=["value"],ue={class:"col-12 mt-4"},ce={class:"pagination"},pe=["onClick"],w=10,me={__name:"bills",setup(ve){I();const T=new L,b=d(!1),v=d(!1),h=d(!1),u=d([]),p=d([{id:21,bill_type_id:4,property_id:4,start_date:"2025-03-01",end_date:"2025-03-31",due_date:"2025-04-10",amount:"950000.00",status:"pending",property:{id:4,sku:"FO-APTO-201"},bill_types:{id:4,name:"Agua"}},{id:22,bill_type_id:3,property_id:5,start_date:"2025-03-01",end_date:"2025-03-31",due_date:"2025-04-10",amount:"1200000.00",status:"paid",property:{id:5,sku:"SE-APTO-301"},bill_types:{id:3,name:"Renta"}},{id:23,bill_type_id:2,property_id:4,start_date:"2025-04-01",end_date:"2025-04-30",due_date:"2025-05-10",amount:"850000.00",status:"pending",property:{id:4,sku:"FO-APTO-201"},bill_types:{id:2,name:"Renta"}}]),r=d({amount:0,payment_method:"",payment_proof:null}),o=d({}),c=d(1),y=M(()=>Math.ceil(p.value.length/w));M(()=>{const a=(c.value-1)*w;return p.value.slice(a,a+w)});const V=()=>{u.value.length!==0&&(r.value.amount=u.value.reduce((a,t)=>{const s=p.value.find(f=>f.id===t);return a+parseFloat(s.amount)},0),h.value=!0)},_=()=>{h.value=!1,r.value={amount:0,payment_method:"",payment_proof:null},o.value={}},j=a=>{const t=a.target.files[0];t&&(t.type==="application/pdf"||t.type.startsWith("image/"))?r.value.payment_proof=t:o.value.payment_proof="Solo se permiten archivos PDF o imÃ¡genes"},B=()=>{o.value={};let a=!0;return r.value.payment_method||(o.value.payment_method="MÃ©todo de pago requerido",a=!1),r.value.payment_proof||(o.value.payment_proof="Comprobante de pago requerido",a=!1),a},q=async()=>{B()&&(v.value=!0,b.value=!0,await T.payBills().then(a=>{a.success?(p.value=p.value.filter(t=>!u.value.includes(t.id)),x.fire("Â¡Pago exitoso!","Las facturas han sido marcadas como pagadas.","success")):x.fire("Error","Hubo un problema al procesar el pago. Por favor intente nuevamente.","error")}).catch(a=>{console.log(a),x.fire("Error","Hubo un problema al procesar el pago. Por favor intente nuevamente.","error")}),u.value=[],_(),v.value=!1,b.value=!1)},C=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(a),P=a=>{const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString("es-CO",t)},k=a=>{a>=1&&a<=y.value&&(c.value=a)};return(a,t)=>(i(),n("div",R,[b.value?(i(),n("div",U,t[4]||(t[4]=[e("div",{class:"spinner-border text-light",role:"status"},[e("span",{class:"visually-hidden"})],-1)]))):g("",!0),h.value?(i(),n("div",{key:1,class:"modal",onClick:F(_,["self"])},[e("div",$,[e("div",{class:"modal-header"},[t[5]||(t[5]=e("span",{class:"modal-title"},"ðŸ’³ Pagar Factura(s)",-1)),e("button",{class:"close-button",onClick:_},"Ã—")]),e("div",z,[e("form",{onSubmit:F(q,["prevent"])},[e("div",null,[e("div",W,[e("div",G,[e("div",J,[e("div",K,[t[6]||(t[6]=e("label",{class:"etiqueta"},"Monto Total (COP)",-1)),e("input",{value:C(r.value.amount),type:"text",class:"entrada",disabled:""},null,8,Q)]),e("div",X,[t[7]||(t[7]=e("label",{class:"etiqueta"},"MÃ©todo de Pago",-1)),O(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.payment_method=s),type:"text",class:m(["entrada",{"is-invalid":o.value.payment_method}]),placeholder:"Ej: Transferencia Bancaria"},null,2),[[E,r.value.payment_method]]),o.value.payment_method?(i(),n("div",Y,l(o.value.payment_method),1)):g("",!0)]),e("div",Z,[t[8]||(t[8]=e("label",{class:"etiqueta"},"Comprobante de Pago (Imagen)",-1)),e("input",{type:"file",onChange:j,accept:".pdf,.jpg,.jpeg,.png",class:m(["entrada",{"is-invalid":o.value.payment_proof}])},null,34),o.value.payment_proof?(i(),n("div",ee,l(o.value.payment_proof),1)):g("",!0)])])])])]),e("div",te,[e("button",{type:"button",class:"boton-secundario",onClick:_}," Cerrar "),e("button",{type:"submit",class:"boton-primario",disabled:v.value,style:{width:"auto"}},l(v.value?"Procesando...":"Pagar"),9,ae)])],32)])])])):g("",!0),e("div",se,[e("div",oe,[t[10]||(t[10]=e("h2",{class:"titulo-seccion",style:{margin:"0"}},"ðŸ“„ Facturas",-1)),e("button",{class:"boton-primario",onClick:V,style:{width:"auto"},disabled:u.value.length===0},t[9]||(t[9]=[e("i",{class:"fas fa-money-bill-wave",style:{"margin-right":"10px"}},null,-1),N("Pagar Factura ")]),8,le)]),e("div",ne,[e("div",ie,[e("table",re,[t[11]||(t[11]=e("thead",{style:{"background-color":"#8f754f",color:"white"}},[e("tr",null,[e("th"),e("th",null,"Nombre"),e("th",null,"Inmueble"),e("th",null,"Desde"),e("th",null,"Hasta"),e("th",null,"Vence"),e("th",null,"Monto")])],-1)),e("tbody",null,[(i(!0),n(D,null,S(p.value,s=>(i(),n("tr",{key:s.id},[e("td",null,[O(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=f=>u.value=f),value:s.id,style:{height:"100%"}},null,8,de),[[H,u.value]])]),e("td",null,l(s.bill_types.name),1),e("td",null,l(s.property.sku),1),e("td",null,l(P(s.start_date)),1),e("td",null,l(P(s.end_date)),1),e("td",null,l(P(s.due_date)),1),e("td",null,l(C(s.amount)),1)]))),128))])])])]),e("div",ue,[e("nav",null,[e("ul",ce,[e("li",{class:m(["page-item",{disabled:c.value===1}])},[e("a",{class:"page-link",onClick:t[2]||(t[2]=s=>k(c.value-1)),href:"#"},t[12]||(t[12]=[e("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(i(!0),n(D,null,S(y.value,s=>(i(),n("li",{class:m(["page-item",{active:c.value===s}]),key:s},[e("a",{class:"page-link",onClick:f=>k(s),href:"#"},l(s),9,pe)],2))),128)),e("li",{class:m(["page-item",{disabled:c.value===y.value||y.value===0}])},[e("a",{class:"page-link",onClick:t[3]||(t[3]=s=>k(c.value+1)),href:"#"},t[13]||(t[13]=[e("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},be=A(me,[["__scopeId","data-v-90d9dec8"]]);export{be as default};
