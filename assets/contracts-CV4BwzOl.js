import{A as U,_ as et,r as u,j as at,i as ot,k as lt,x as B,c as s,b as c,d as t,q as D,w as y,v as P,n as v,t as i,s as A,F as C,p as k,g as nt,o as r}from"./index-Dnv4c8ld.js";import{t as st}from"./tenantApplication-Cx2YC7vw.js";import{S as d}from"./sweetalert2.esm.all-B0Dix5B2.js";class rt{getContracts(){return U({url:"/contract/all",method:"get"})}createContract(M){return U({url:"/contract/create",method:"post",data:M,headers:{"Content-Type":"multipart/form-data"}})}terminarContrato(M){return U({url:"/contract/terminate",method:"put",data:M})}}const it={class:"container"},dt={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},ut={class:"modal-content",style:{"overflow-y":"auto",height:"auto","max-width":"880px"}},ct={class:"modal-body p-4"},vt={class:"contenedor-campos",style:{gap:"10px !important"}},pt={class:"grupo-campos"},mt={class:"campos-grid"},ft={class:"campo"},_t={key:0,class:"text-danger mt-1"},ht={class:"campo"},yt={key:0,class:"text-danger mt-1"},gt={class:"campo"},bt={key:0,class:"text-danger mt-1"},Ct={class:"campo"},kt={key:0,class:"text-danger mt-1"},Mt={class:"campo"},xt=["value"],wt={key:0,class:"text-danger mt-1"},St={class:"campo"},Ft=["value"],Et={key:0,class:"text-danger mt-1"},Dt={class:"campo"},Pt={key:0,class:"text-danger mt-1"},At={class:"modal-footer"},Tt=["disabled"],$t={class:"modal-content"},qt={class:"modal-body"},Ot=["src"],Vt={class:"row seccion mainSeccion mt-4"},Ht={class:"col-12 d-flex justify-content-between align-items-center mb-4"},It={class:"col-12 mb-4"},Ut={class:"row"},Bt={class:"col-md-6 mb-3"},Nt=["value"],zt={class:"col-md-6 mb-3"},Lt=["value"],Rt={class:"col-12"},jt={style:{"overflow-x":"auto"}},Gt={class:"table table-bordered table-striped table-hover align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},Qt=["onClick"],Jt=["onClick"],Kt={key:0},Wt={class:"col-12",style:{"margin-top":"20px"}},Xt={class:"pagination"},Yt=["onClick"],N=10,Zt={__name:"contracts",setup(j){const M=new lt,T=new rt,G=new st,m=ot(),x=["FO-APTO-301","SE-APTO-201","SE-APTO-301","FO-PARQ-1"],p=u((()=>{const a=[],e=["En curso","Terminado"],o=["Laura G√≥mez","Carlos P√©rez","Mar√≠a Rodr√≠guez","Andr√©s L√≥pez"];for(let h=1;h<=25;h++)a.push({id:h,property_id:Math.floor(Math.random()*4)+1,user_id:Math.floor(Math.random()*4)+1,tenant_application_id:Math.floor(Math.random()*10)+1,start_date:`202${Math.floor(Math.random()*5)}-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}`,end_date:`202${Math.floor(Math.random()*5)+3}-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}`,monthly_amount:(Math.random()*3e6+1e6).toFixed(2),deposit_amount:(Math.random()*3e6+1e6).toFixed(2),status:e[Math.floor(Math.random()*2)],created_at:`${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}/${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}/2023`,contract_doc:"https://pdfobject.com/pdf/sample.pdf",property:{sku:x[Math.floor(Math.random()*x.length)]},user:{name:o[Math.floor(Math.random()*o.length)]}});return a})()),f=u([{id:1,sku:"a"}]),g=u(Array.from({length:10},(a,e)=>({id:e+1,property_id:f.value[Math.floor(Math.random()*1)].sku,financial_responsibles:[{full_name:["Laura","Carlos","Mar√≠a","Andr√©s"][Math.floor(Math.random()*4)]}],property:{sku:x[Math.floor(Math.random()*x.length)]}})));at(async()=>{_.value=!0,f.value=m.getters.getProperties,f.value.length==0&&await M.getAllProperties().then(a=>{a&&a.success?(m.commit("setProperties",a.data),f.value=m.getters.getProperties,console.log(f.value)):d.fire("Error","Hubo un error, intenta de nuevo","error")}).catch(a=>{d.fire("Error","Hubo un error, intenta de nuevo","error")}),f.value=f.value.filter(a=>!a.is_occupied),g.value=m.getters.getTenantApplications,g.value.length==0&&await G.getTenantApplications().then(a=>{a&&a.success?(g.value=a.data,m.commit("setTenantApplications",g.value)):d.fire("Error","Hubo un error, intenta despues.","error")}).catch(a=>{console.log(a),d.fire("Error","Hubo un error, intenta despues.","error")}),g.value=g.value.filter(a=>a.status!=="En curso"),p.value=m.getters.getContracts,p.value.length==0&&await T.getContracts().then(a=>{a&&a.success?(p.value=a.data,m.commit("setContracts",p.value)):d.fire("Error","Hubo un error, intenta despues.","error")}).catch(a=>{console.log(a),d.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1});const w=u(""),S=u(""),b=u(1),$=B(()=>p.value.filter(a=>{const e=!w.value||a.property.sku===w.value,o=!S.value||a.status===S.value;return e&&o})),F=B(()=>Math.ceil($.value.length/N)),z=B(()=>{console.log($.value);const a=(b.value-1)*N;return $.value.slice(a,a+N)}),Q=["En curso","Terminado"],q=u(!1),O=u(!1),V=u(""),_=u(!1),n=u({start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null});async function J(a){const e=await d.fire({title:"¬øEst√°s seguro?",text:"¬øDeseas terminar este contrato?",icon:"warning",showCancelButton:!0,confirmButtonText:"S√≠, terminar",cancelButtonText:"No, cancelar",reverseButtons:!0});_.value=!0,e.isConfirmed&&await T.terminarContrato({id:a}).then(o=>{if(o&&o.success){const h=p.value.findIndex(tt=>tt.id===a);h!==-1&&(p.value[h].status="Terminado"),m.commit("setContracts",p.value)}else d.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{console.log(o),d.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1}const l=u({}),K=()=>{l.value={};let a=!0;return n.value.start_date||(l.value.start_date="Fecha de inicio requerida",a=!1),n.value.end_date||(l.value.end_date="Fecha de fin requerida",a=!1),new Date(n.value.end_date)<=new Date(n.value.start_date)&&(l.value.end_date="La fecha de fin debe ser posterior a la fecha de inicio",a=!1),(!n.value.monthly_amount||n.value.monthly_amount<=0)&&(l.value.monthly_amount="Monto mensual inv√°lido",a=!1),(!n.value.deposit_amount||n.value.deposit_amount<=0)&&(l.value.deposit_amount="Dep√≥sito inv√°lido",a=!1),n.value.tenant_application_id||(l.value.tenant_application_id="Seleccione una solicitud",a=!1),n.value.property_id||(l.value.property_id="Seleccione un inmueble",a=!1),n.value.contract_doc||(l.value.contract_doc="Documento requerido",a=!1),a},W=a=>{n.value.contract_doc=a.target.files[0]},X=async()=>{K()&&(_.value=!0,await T.createContract(n.value).then(a=>{a&&a.success?a.error?d.fire("¬°Error!","Hay un contrato en curso de esta propiedad.","error"):(p.value.push(a.data),m.commit("setContracts",p.value),d.fire("¬°√âxito!","El contrato ha sido creado exitosamente.","success")):d.fire("Error","Hubo un error, intenta despues.","error")}).catch(a=>{console.log(a),d.fire("Error","Hubo un error, intenta despues.","error")}),E(),_.value=!1)},Y=a=>{V.value=a,O.value=!0},E=()=>{q.value=!1,n.value={start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null},l.value={}},L=()=>{O.value=!1,V.value=""},R=a=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(a),H=a=>{const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(a).toLocaleDateString("es-CO",e)},Z=a=>({"En curso":"bg-en-curso",Terminado:"bg-terminado"})[a],I=a=>{a>=1&&a<=F.value&&(b.value=a)};return(a,e)=>(r(),s("div",it,[_.value?(r(),s("div",dt,e[11]||(e[11]=[t("div",{class:"spinner-border text-light",role:"status"},[t("span",{class:"visually-hidden"})],-1)]))):c("",!0),q.value?(r(),s("div",{key:1,class:"modal",onClick:D(E,["self"])},[t("div",ut,[t("div",{class:"modal-header"},[e[12]||(e[12]=t("span",{class:"modal-title"},"üìù Crear Nuevo Contrato",-1)),t("button",{class:"close-button",onClick:E},"√ó")]),t("div",ct,[t("form",{onSubmit:D(X,["prevent"])},[t("div",null,[t("div",vt,[t("div",pt,[t("div",mt,[t("div",ft,[e[13]||(e[13]=t("label",{class:"etiqueta"},"Fecha de Inicio",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.start_date=o),type:"date",class:v(["entrada",{"is-invalid":l.value.start_date}]),placeholder:"Fecha de Inicio"},null,2),[[P,n.value.start_date]]),l.value.start_date?(r(),s("div",_t,i(l.value.start_date),1)):c("",!0)]),t("div",ht,[e[14]||(e[14]=t("label",{class:"etiqueta"},"Fecha de Fin",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.end_date=o),type:"date",class:v(["entrada",{"is-invalid":l.value.end_date}]),placeholder:"Fecha de Fin"},null,2),[[P,n.value.end_date]]),l.value.end_date?(r(),s("div",yt,i(l.value.end_date),1)):c("",!0)]),t("div",gt,[e[15]||(e[15]=t("label",{class:"etiqueta"},"Monto Mensual (COP)",-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.monthly_amount=o),type:"number",class:v(["entrada",{"is-invalid":l.value.monthly_amount}]),placeholder:"Monto Mensual"},null,2),[[P,n.value.monthly_amount]]),l.value.monthly_amount?(r(),s("div",bt,i(l.value.monthly_amount),1)):c("",!0)]),t("div",Ct,[e[16]||(e[16]=t("label",{class:"etiqueta"},"Dep√≥sito (COP)",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.deposit_amount=o),type:"number",class:v(["entrada",{"is-invalid":l.value.deposit_amount}]),placeholder:"Dep√≥sito"},null,2),[[P,n.value.deposit_amount]]),l.value.deposit_amount?(r(),s("div",kt,i(l.value.deposit_amount),1)):c("",!0)]),t("div",Mt,[e[18]||(e[18]=t("label",{class:"etiqueta"},"Solicitud de Arrendamiento",-1)),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.tenant_application_id=o),class:v(["entrada",{"is-invalid":l.value.tenant_application_id}])},[e[17]||(e[17]=t("option",{value:"",disabled:"",selected:""},"Seleccionar Solicitud",-1)),(r(!0),s(C,null,k(g.value,o=>(r(),s("option",{key:o.id,value:o.id},i(o.property.sku)+" - "+i(o.financial_responsibles[0].full_name),9,xt))),128))],2),[[A,n.value.tenant_application_id]]),l.value.tenant_application_id?(r(),s("div",wt,i(l.value.tenant_application_id),1)):c("",!0)]),t("div",St,[e[20]||(e[20]=t("label",{class:"etiqueta"},"Inmueble",-1)),y(t("select",{"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.property_id=o),class:v(["entrada",{"is-invalid":l.value.property_id}])},[e[19]||(e[19]=t("option",{value:"",disabled:"",selected:""},"Seleccionar Inmueble",-1)),(r(!0),s(C,null,k(f.value,o=>(r(),s("option",{key:o.id,value:o.id},i(o.sku),9,Ft))),128))],2),[[A,n.value.property_id]]),l.value.property_id?(r(),s("div",Et,i(l.value.property_id),1)):c("",!0)]),t("div",Dt,[e[21]||(e[21]=t("label",{class:"etiqueta"},"Documento del Contrato (PDF)",-1)),t("input",{type:"file",onChange:W,accept:".pdf",class:v(["entrada",{"is-invalid":l.value.contract_doc}])},null,34),l.value.contract_doc?(r(),s("div",Pt,i(l.value.contract_doc),1)):c("",!0)])])])])]),t("div",At,[t("button",{type:"button",class:"boton-secundario",onClick:E}," Cancelar "),t("button",{type:"submit",class:"boton-primario",disabled:_.value,style:{width:"auto"}},i(_.value?"Creando...":"Crear Contrato"),9,Tt)])],32)])])])):c("",!0),O.value?(r(),s("div",{key:2,class:"modal",onClick:D(L,["self"])},[t("div",$t,[t("div",{class:"modal-header"},[e[22]||(e[22]=t("span",{class:"modal-title"},"Documento del Contrato",-1)),t("button",{class:"close-button",onClick:L},"√ó")]),t("div",qt,[t("iframe",{src:V.value,width:"100%",height:"100%",style:{border:"none"}},null,8,Ot)])])])):c("",!0),t("div",Vt,[t("div",Ht,[e[24]||(e[24]=t("h2",{class:"titulo-seccion",style:{margin:"0"}},"üìë Contratos",-1)),t("button",{class:"boton-primario",onClick:e[6]||(e[6]=o=>q.value=!0),style:{width:"auto"}},e[23]||(e[23]=[t("i",{class:"fas fa-plus",style:{"margin-right":"10px"}},null,-1),nt("Crear Contrato ")]))]),t("div",It,[t("div",Ut,[t("div",Bt,[y(t("select",{class:"entrada","onUpdate:modelValue":e[7]||(e[7]=o=>w.value=o),style:{"background-color":"#f8f5f0"}},[e[25]||(e[25]=t("option",{value:""},"Todos las Propiedades",-1)),(r(!0),s(C,null,k(f.value,o=>(r(),s("option",{key:o,value:o.sku},i(o.sku),9,Nt))),128))],512),[[A,w.value]])]),t("div",zt,[y(t("select",{class:"entrada","onUpdate:modelValue":e[8]||(e[8]=o=>S.value=o),style:{"background-color":"#f8f5f0"}},[e[26]||(e[26]=t("option",{value:""},"Todos los Estados",-1)),(r(),s(C,null,k(Q,o=>t("option",{key:o,value:o},i(o),9,Lt)),64))],512),[[A,S.value]])])])]),t("div",Rt,[t("div",jt,[t("table",Gt,[e[29]||(e[29]=t("thead",{style:{"background-color":"#8f754f",color:"white"}},[t("tr",null,[t("th",null,"Inicio"),t("th",null,"Fin"),t("th",null,"Arriendo"),t("th",null,"Dep√≥sito"),t("th",null,"Inquilino"),t("th",null,"Inmueble"),t("th",null,"Status"),t("th",null,"Contrato"),t("th",null,"Fecha Creaci√≥n"),t("th")])],-1)),t("tbody",null,[(r(!0),s(C,null,k(z.value,o=>(r(),s("tr",{key:o.id},[t("td",null,i(H(o.start_date)),1),t("td",null,i(H(o.end_date)),1),t("td",null,i(R(o.monthly_amount)),1),t("td",null,i(R(o.deposit_amount)),1),t("td",null,i(o.user.name),1),t("td",null,i(o.property.sku),1),t("td",null,[t("span",{class:v(["badge",Z(o.status)])},i(o.status),3)]),t("td",null,[o.contract_doc?(r(),s("a",{key:0,onClick:D(h=>Y(o.contract_doc_url),["prevent"])},e[27]||(e[27]=[t("i",{class:"fas fa-file-pdf",style:{color:"black"}},null,-1)]),8,Qt)):c("",!0)]),t("td",null,i(H(o.created_at)),1),t("td",null,[t("i",{class:"fa-solid fa-trash",onClick:h=>J(o.id),style:{cursor:"pointer"}},null,8,Jt)])]))),128)),z.value.length===0?(r(),s("tr",Kt,e[28]||(e[28]=[t("td",{colspan:"10",class:"text-center py-4"},"No hay contratos",-1)]))):c("",!0)])])])]),t("div",Wt,[t("nav",null,[t("ul",Xt,[t("li",{class:v(["page-item",{disabled:b.value===1}])},[t("a",{class:"page-link",onClick:e[9]||(e[9]=o=>I(b.value-1)),href:"#"},e[30]||(e[30]=[t("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(r(!0),s(C,null,k(F.value,o=>(r(),s("li",{class:v(["page-item",{active:b.value===o}]),key:o},[t("a",{class:"page-link",onClick:h=>I(o),href:"#"},i(o),9,Yt)],2))),128)),t("li",{class:v(["page-item",{disabled:b.value===F.value||F.value===0}])},[t("a",{class:"page-link",onClick:e[10]||(e[10]=o=>I(b.value+1)),href:"#"},e[31]||(e[31]=[t("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},le=et(Zt,[["__scopeId","data-v-def78912"]]);export{le as default};
