import{A as B,_ as te,r as d,j as ae,i as oe,k as le,m as N,c as n,b as c,d as e,s as M,w as y,v as P,n as v,t as i,x as T,F as C,q as k,g as se,o as r}from"./index-CKTdGYVq.js";import{t as ne}from"./tenantApplication-BAOxGvNT.js";import{S as u}from"./sweetalert2.esm.all-B0Dix5B2.js";class re{getContracts(){return B({url:"/contract/all",method:"get"})}createContract(w){return B({url:"/contract/create",method:"post",data:w,headers:{"Content-Type":"multipart/form-data"}})}terminarContrato(w){return B({url:"/contract/terminate",method:"put",data:w})}}const ie={class:"container"},ue={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},de={class:"modal-content",style:{"overflow-y":"auto",height:"auto","max-width":"880px"}},ce={class:"modal-body p-4"},ve={class:"contenedor-campos",style:{gap:"10px !important"}},me={class:"grupo-campos"},pe={class:"campos-grid"},_e={class:"campo"},fe={key:0,class:"text-danger mt-1"},ye={class:"campo"},be={key:0,class:"text-danger mt-1"},he={class:"campo"},ge={key:0,class:"text-danger mt-1"},Ce={class:"campo"},ke={key:0,class:"text-danger mt-1"},we={class:"campo"},xe=["value"],De={key:0,class:"text-danger mt-1"},Se={class:"campo"},Ee=["value"],Fe={key:0,class:"text-danger mt-1"},Me={class:"campo"},Pe={key:0,class:"text-danger mt-1"},Te={class:"modal-footer"},qe=["disabled"],Ve={class:"modal-content"},He={class:"modal-body"},Ie=["src"],Ue={class:"row seccion mainSeccion mt-4"},Ae={class:"col-12 d-flex justify-content-between align-items-center mb-4"},Be={class:"col-12 mb-4"},Ne={class:"row"},$e={class:"col-md-6 mb-3"},Oe=["value"],je={class:"col-md-6 mb-3"},Le=["value"],Re={class:"col-12"},ze={style:{"overflow-x":"auto"}},Ke={class:"table table-bordered table-striped table-hover align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},Ge=["onClick"],Je=["onClick"],Qe={key:0},We={class:"col-12",style:{"margin-top":"20px"}},Xe={class:"pagination"},Ye=["onClick"],$=10,Ze={__name:"contracts",setup(K){const w=new le,q=new re,G=new ne,p=oe(),m=d(),b=d([{id:1,sku:"a"}]),h=d({});ae(async()=>{_.value=!0,b.value=p.getters.getProperties,b.value.length==0&&await w.getAllProperties().then(o=>{o&&o.success?(p.commit("setProperties",o.data),b.value=p.getters.getProperties):u.fire("Error","Hubo un error, intenta de nuevo","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta de nuevo","error")}),b.value=b.value.filter(o=>!o.is_occupied),h.value=p.getters.getTenantApplications,h.value.length==0&&await G.getTenantApplications().then(o=>{o&&o.success?(h.value=o.data,p.commit("setTenantApplications",h.value)):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),h.value=h.value.filter(o=>o.status!=="En curso"),m.value=p.getters.getContracts,m.value.length==0&&await q.getContracts().then(o=>{o&&o.success?(m.value=o.data,p.commit("setContracts",m.value)):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1});const x=d(""),D=d(""),g=d(1),O=N(()=>m.value.filter(o=>{const t=!x.value||o.property.sku===x.value,a=!D.value||o.status===D.value;return t&&a})),S=N(()=>Math.ceil(O.value.length/$)),j=N(()=>{const o=(g.value-1)*$;return O.value.slice(o,o+$)}),J=["En curso","Terminado"],V=d(!1),H=d(!1),I=d(""),_=d(!1),s=d({start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null});async function Q(o){const t=await u.fire({title:"¿Estás seguro?",text:"¿Deseas terminar este contrato?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, terminar",cancelButtonText:"No, cancelar",reverseButtons:!0});_.value=!0,t.isConfirmed&&await q.terminarContrato({id:o}).then(a=>{if(a&&a.success){const f=m.value.findIndex(F=>F.id===o);f!==-1&&(m.value[f].status="Terminado"),p.commit("setContracts",m.value)}else u.fire("Error","Hubo un error, intenta despues.","error")}).catch(a=>{u.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1}const l=d({}),W=()=>{l.value={};let o=!0;return s.value.start_date||(l.value.start_date="Fecha de inicio requerida",o=!1),s.value.end_date||(l.value.end_date="Fecha de fin requerida",o=!1),new Date(s.value.end_date)<=new Date(s.value.start_date)&&(l.value.end_date="La fecha de fin debe ser posterior a la fecha de inicio",o=!1),(!s.value.monthly_amount||s.value.monthly_amount<=0)&&(l.value.monthly_amount="Monto mensual inválido",o=!1),(!s.value.deposit_amount||s.value.deposit_amount<=0)&&(l.value.deposit_amount="Depósito inválido",o=!1),s.value.tenant_application_id||(l.value.tenant_application_id="Seleccione una solicitud",o=!1),s.value.property_id||(l.value.property_id="Seleccione un inmueble",o=!1),s.value.contract_doc||(l.value.contract_doc="Documento requerido",o=!1),o},X=o=>{s.value.contract_doc=o.target.files[0]},Y=async()=>{W()&&(_.value=!0,await q.createContract(s.value).then(o=>{o&&o.success?o.error?u.fire("¡Error!","Hay un contrato en curso de esta propiedad.","error"):(m.value.push(o.data),p.commit("setContracts",m.value),u.fire("¡Éxito!","El contrato ha sido creado exitosamente.","success")):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),E(),_.value=!1)},Z=o=>{I.value=o,H.value=!0},E=()=>{V.value=!1,s.value={start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null},l.value={}},L=()=>{H.value=!1,I.value=""},R=o=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(o),U=o=>{const t={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString("es-CO",t)},ee=o=>({"En curso":"bg-en-curso",Terminado:"bg-terminado"})[o],A=o=>{o>=1&&o<=S.value&&(g.value=o)};return(o,t)=>(r(),n("div",ie,[_.value?(r(),n("div",ue,t[11]||(t[11]=[e("div",{class:"spinner-border text-light",role:"status"},[e("span",{class:"visually-hidden"})],-1)]))):c("",!0),V.value?(r(),n("div",{key:1,class:"modal",onClick:M(E,["self"])},[e("div",de,[e("div",{class:"modal-header"},[t[12]||(t[12]=e("span",{class:"modal-title"},"📝 Crear Nuevo Contrato",-1)),e("button",{class:"close-button",onClick:E},"×")]),e("div",ce,[e("form",{onSubmit:M(Y,["prevent"])},[e("div",null,[e("div",ve,[e("div",me,[e("div",pe,[e("div",_e,[t[13]||(t[13]=e("label",{class:"etiqueta"},"Fecha de Inicio",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.value.start_date=a),type:"date",class:v(["entrada",{"is-invalid":l.value.start_date}]),placeholder:"Fecha de Inicio"},null,2),[[P,s.value.start_date]]),l.value.start_date?(r(),n("div",fe,i(l.value.start_date),1)):c("",!0)]),e("div",ye,[t[14]||(t[14]=e("label",{class:"etiqueta"},"Fecha de Fin",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>s.value.end_date=a),type:"date",class:v(["entrada",{"is-invalid":l.value.end_date}]),placeholder:"Fecha de Fin"},null,2),[[P,s.value.end_date]]),l.value.end_date?(r(),n("div",be,i(l.value.end_date),1)):c("",!0)]),e("div",he,[t[15]||(t[15]=e("label",{class:"etiqueta"},"Monto Mensual (COP)",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>s.value.monthly_amount=a),type:"number",class:v(["entrada",{"is-invalid":l.value.monthly_amount}]),placeholder:"Monto Mensual"},null,2),[[P,s.value.monthly_amount]]),l.value.monthly_amount?(r(),n("div",ge,i(l.value.monthly_amount),1)):c("",!0)]),e("div",Ce,[t[16]||(t[16]=e("label",{class:"etiqueta"},"Depósito (COP)",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>s.value.deposit_amount=a),type:"number",class:v(["entrada",{"is-invalid":l.value.deposit_amount}]),placeholder:"Depósito"},null,2),[[P,s.value.deposit_amount]]),l.value.deposit_amount?(r(),n("div",ke,i(l.value.deposit_amount),1)):c("",!0)]),e("div",we,[t[18]||(t[18]=e("label",{class:"etiqueta"},"Solicitud de Arrendamiento",-1)),y(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>s.value.tenant_application_id=a),class:v(["entrada",{"is-invalid":l.value.tenant_application_id}])},[t[17]||(t[17]=e("option",{value:"",disabled:"",selected:""},"Seleccionar Solicitud",-1)),(r(!0),n(C,null,k(h.value,a=>{var f,F,z;return r(),n("option",{key:a==null?void 0:a.id,value:a==null?void 0:a.id},i(((f=a==null?void 0:a.property)==null?void 0:f.sku)||"Sin SKU")+" - "+i(((z=(F=a==null?void 0:a.financial_responsibles)==null?void 0:F[0])==null?void 0:z.full_name)||"Sin nombre"),9,xe)}),128))],2),[[T,s.value.tenant_application_id]]),l.value.tenant_application_id?(r(),n("div",De,i(l.value.tenant_application_id),1)):c("",!0)]),e("div",Se,[t[20]||(t[20]=e("label",{class:"etiqueta"},"Inmueble",-1)),y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=a=>s.value.property_id=a),class:v(["entrada",{"is-invalid":l.value.property_id}])},[t[19]||(t[19]=e("option",{value:"",disabled:"",selected:""},"Seleccionar Inmueble",-1)),(r(!0),n(C,null,k(b.value,a=>(r(),n("option",{key:a.id,value:a.id},i(a.sku),9,Ee))),128))],2),[[T,s.value.property_id]]),l.value.property_id?(r(),n("div",Fe,i(l.value.property_id),1)):c("",!0)]),e("div",Me,[t[21]||(t[21]=e("label",{class:"etiqueta"},"Documento del Contrato (PDF)",-1)),e("input",{type:"file",onChange:X,accept:".pdf",class:v(["entrada",{"is-invalid":l.value.contract_doc}])},null,34),l.value.contract_doc?(r(),n("div",Pe,i(l.value.contract_doc),1)):c("",!0)])])])])]),e("div",Te,[e("button",{type:"button",class:"boton-secundario",onClick:E}," Cancelar "),e("button",{type:"submit",class:"boton-primario",disabled:_.value,style:{width:"auto"}},i(_.value?"Creando...":"Crear Contrato"),9,qe)])],32)])])])):c("",!0),H.value?(r(),n("div",{key:2,class:"modal",onClick:M(L,["self"])},[e("div",Ve,[e("div",{class:"modal-header"},[t[22]||(t[22]=e("span",{class:"modal-title"},"Documento del Contrato",-1)),e("button",{class:"close-button",onClick:L},"×")]),e("div",He,[e("iframe",{src:I.value,width:"100%",height:"100%",style:{border:"none"}},null,8,Ie)])])])):c("",!0),e("div",Ue,[e("div",Ae,[t[24]||(t[24]=e("h2",{class:"titulo-seccion",style:{margin:"0"}},"📑 Contratos",-1)),e("button",{class:"boton-primario",onClick:t[6]||(t[6]=a=>V.value=!0),style:{width:"auto"}},t[23]||(t[23]=[e("i",{class:"fas fa-plus",style:{"margin-right":"10px"}},null,-1),se("Crear Contrato ")]))]),e("div",Be,[e("div",Ne,[e("div",$e,[y(e("select",{class:"entrada","onUpdate:modelValue":t[7]||(t[7]=a=>x.value=a),style:{"background-color":"#f8f5f0"}},[t[25]||(t[25]=e("option",{value:""},"Todos las Propiedades",-1)),(r(!0),n(C,null,k(b.value,a=>(r(),n("option",{key:a,value:a.sku},i(a.sku),9,Oe))),128))],512),[[T,x.value]])]),e("div",je,[y(e("select",{class:"entrada","onUpdate:modelValue":t[8]||(t[8]=a=>D.value=a),style:{"background-color":"#f8f5f0"}},[t[26]||(t[26]=e("option",{value:""},"Todos los Estados",-1)),(r(),n(C,null,k(J,a=>e("option",{key:a,value:a},i(a),9,Le)),64))],512),[[T,D.value]])])])]),e("div",Re,[e("div",ze,[e("table",Ke,[t[29]||(t[29]=e("thead",{style:{"background-color":"#8f754f",color:"white"}},[e("tr",null,[e("th",null,"Inicio"),e("th",null,"Fin"),e("th",null,"Arriendo"),e("th",null,"Depósito"),e("th",null,"Inquilino"),e("th",null,"Inmueble"),e("th",null,"Status"),e("th",null,"Contrato"),e("th",null,"Fecha Creación"),e("th")])],-1)),e("tbody",null,[(r(!0),n(C,null,k(j.value,a=>(r(),n("tr",{key:a.id},[e("td",null,i(U(a.start_date)),1),e("td",null,i(U(a.end_date)),1),e("td",null,i(R(a.monthly_amount)),1),e("td",null,i(R(a.deposit_amount)),1),e("td",null,i(a.user.name),1),e("td",null,i(a.property.sku),1),e("td",null,[e("span",{class:v(["badge",ee(a.status)])},i(a.status),3)]),e("td",null,[a.contract_doc?(r(),n("a",{key:0,onClick:M(f=>Z(a.contract_doc_url),["prevent"])},t[27]||(t[27]=[e("i",{class:"fas fa-file-pdf",style:{color:"black"}},null,-1)]),8,Ge)):c("",!0)]),e("td",null,i(U(a.created_at)),1),e("td",null,[e("i",{class:"fa-solid fa-trash",onClick:f=>Q(a.id),style:{cursor:"pointer"}},null,8,Je)])]))),128)),j.value.length===0?(r(),n("tr",Qe,t[28]||(t[28]=[e("td",{colspan:"10",class:"text-center py-4"},"No hay contratos",-1)]))):c("",!0)])])])]),e("div",We,[e("nav",null,[e("ul",Xe,[e("li",{class:v(["page-item",{disabled:g.value===1}])},[e("a",{class:"page-link",onClick:t[9]||(t[9]=a=>A(g.value-1)),href:"#"},t[30]||(t[30]=[e("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(r(!0),n(C,null,k(S.value,a=>(r(),n("li",{class:v(["page-item",{active:g.value===a}]),key:a},[e("a",{class:"page-link",onClick:f=>A(a),href:"#"},i(a),9,Ye)],2))),128)),e("li",{class:v(["page-item",{disabled:g.value===S.value||S.value===0}])},[e("a",{class:"page-link",onClick:t[10]||(t[10]=a=>A(g.value+1)),href:"#"},t[31]||(t[31]=[e("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},ot=te(Ze,[["__scopeId","data-v-0795fdb4"]]);export{ot as default};
