import{A as O,_ as et,r as d,j as at,i as ot,k as lt,x as U,c as n,b as c,d as t,q as F,w as y,v as S,n as v,t as i,s as P,F as g,p as C,g as st,o as r}from"./index-CnROVEP7.js";import{t as nt}from"./tenantApplication-Bh0JBy-y.js";import{S as u}from"./sweetalert2.esm.all-B0Dix5B2.js";class rt{getContracts(){return O({url:"/contract/all",method:"get"})}createContract(k){return O({url:"/contract/create",method:"post",data:k,headers:{"Content-Type":"multipart/form-data"}})}terminarContrato(k){return O({url:"/contract/terminate",method:"put",data:k})}}const it={class:"container"},ut={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},dt={class:"modal-content",style:{"overflow-y":"auto",height:"auto","max-width":"880px"}},ct={class:"modal-body p-4"},vt={class:"contenedor-campos",style:{gap:"10px !important"}},pt={class:"grupo-campos"},mt={class:"campos-grid"},_t={class:"campo"},ft={key:0,class:"text-danger mt-1"},yt={class:"campo"},ht={key:0,class:"text-danger mt-1"},bt={class:"campo"},gt={key:0,class:"text-danger mt-1"},Ct={class:"campo"},kt={key:0,class:"text-danger mt-1"},wt={class:"campo"},xt=["value"],Mt={key:0,class:"text-danger mt-1"},Dt={class:"campo"},Et=["value"],Ft={key:0,class:"text-danger mt-1"},St={class:"campo"},Pt={key:0,class:"text-danger mt-1"},At={class:"modal-footer"},Tt=["disabled"],qt={class:"modal-content"},Vt={class:"modal-body"},Ht=["src"],It={class:"row seccion mainSeccion mt-4"},Ot={class:"col-12 d-flex justify-content-between align-items-center mb-4"},Ut={class:"col-12 mb-4"},Bt={class:"row"},Nt={class:"col-md-6 mb-3"},$t=["value"],Lt={class:"col-md-6 mb-3"},Rt=["value"],jt={class:"col-12"},zt={style:{"overflow-x":"auto"}},Qt={class:"table table-bordered table-striped table-hover align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},Gt=["onClick"],Jt=["onClick"],Kt={key:0},Wt={class:"col-12",style:{"margin-top":"20px"}},Xt={class:"pagination"},Yt=["onClick"],B=10,Zt={__name:"contracts",setup(z){const k=new lt,A=new rt,Q=new nt,m=ot(),N=["FO-APTO-301","SE-APTO-201","SE-APTO-301","FO-PARQ-1"],p=d(),f=d([{id:1,sku:"a"}]),h=d(Array.from({length:10},(o,e)=>({id:e+1,property_id:f.value[Math.floor(Math.random()*1)].sku,financial_responsibles:[{full_name:["Laura","Carlos","María","Andrés"][Math.floor(Math.random()*4)]}],property:{sku:N[Math.floor(Math.random()*N.length)]}})));at(async()=>{_.value=!0,f.value=m.getters.getProperties,f.value.length==0&&await k.getAllProperties().then(o=>{o&&o.success?(m.commit("setProperties",o.data),f.value=m.getters.getProperties):u.fire("Error","Hubo un error, intenta de nuevo","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta de nuevo","error")}),f.value=f.value.filter(o=>!o.is_occupied),h.value=m.getters.getTenantApplications,h.value.length==0&&await Q.getTenantApplications().then(o=>{o&&o.success?(h.value=o.data,m.commit("setTenantApplications",h.value)):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),h.value=h.value.filter(o=>o.status!=="En curso"),p.value=m.getters.getContracts,p.value.length==0&&await A.getContracts().then(o=>{o&&o.success?(p.value=o.data,m.commit("setContracts",p.value)):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1});const x=d(""),M=d(""),b=d(1),$=U(()=>p.value.filter(o=>{const e=!x.value||o.property.sku===x.value,a=!M.value||o.status===M.value;return e&&a})),D=U(()=>Math.ceil($.value.length/B)),L=U(()=>{const o=(b.value-1)*B;return $.value.slice(o,o+B)}),G=["En curso","Terminado"],T=d(!1),q=d(!1),V=d(""),_=d(!1),s=d({start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null});async function J(o){const e=await u.fire({title:"¿Estás seguro?",text:"¿Deseas terminar este contrato?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, terminar",cancelButtonText:"No, cancelar",reverseButtons:!0});_.value=!0,e.isConfirmed&&await A.terminarContrato({id:o}).then(a=>{if(a&&a.success){const w=p.value.findIndex(tt=>tt.id===o);w!==-1&&(p.value[w].status="Terminado"),m.commit("setContracts",p.value)}else u.fire("Error","Hubo un error, intenta despues.","error")}).catch(a=>{u.fire("Error","Hubo un error, intenta despues.","error")}),_.value=!1}const l=d({}),K=()=>{l.value={};let o=!0;return s.value.start_date||(l.value.start_date="Fecha de inicio requerida",o=!1),s.value.end_date||(l.value.end_date="Fecha de fin requerida",o=!1),new Date(s.value.end_date)<=new Date(s.value.start_date)&&(l.value.end_date="La fecha de fin debe ser posterior a la fecha de inicio",o=!1),(!s.value.monthly_amount||s.value.monthly_amount<=0)&&(l.value.monthly_amount="Monto mensual inválido",o=!1),(!s.value.deposit_amount||s.value.deposit_amount<=0)&&(l.value.deposit_amount="Depósito inválido",o=!1),s.value.tenant_application_id||(l.value.tenant_application_id="Seleccione una solicitud",o=!1),s.value.property_id||(l.value.property_id="Seleccione un inmueble",o=!1),s.value.contract_doc||(l.value.contract_doc="Documento requerido",o=!1),o},W=o=>{s.value.contract_doc=o.target.files[0]},X=async()=>{K()&&(_.value=!0,await A.createContract(s.value).then(o=>{o&&o.success?o.error?u.fire("¡Error!","Hay un contrato en curso de esta propiedad.","error"):(p.value.push(o.data),m.commit("setContracts",p.value),u.fire("¡Éxito!","El contrato ha sido creado exitosamente.","success")):u.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{u.fire("Error","Hubo un error, intenta despues.","error")}),E(),_.value=!1)},Y=o=>{V.value=o,q.value=!0},E=()=>{T.value=!1,s.value={start_date:"",end_date:"",monthly_amount:"",deposit_amount:"",tenant_application_id:"",property_id:"",contract_doc:null},l.value={}},R=()=>{q.value=!1,V.value=""},j=o=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(o),H=o=>{const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString("es-CO",e)},Z=o=>({"En curso":"bg-en-curso",Terminado:"bg-terminado"})[o],I=o=>{o>=1&&o<=D.value&&(b.value=o)};return(o,e)=>(r(),n("div",it,[_.value?(r(),n("div",ut,e[11]||(e[11]=[t("div",{class:"spinner-border text-light",role:"status"},[t("span",{class:"visually-hidden"})],-1)]))):c("",!0),T.value?(r(),n("div",{key:1,class:"modal",onClick:F(E,["self"])},[t("div",dt,[t("div",{class:"modal-header"},[e[12]||(e[12]=t("span",{class:"modal-title"},"📝 Crear Nuevo Contrato",-1)),t("button",{class:"close-button",onClick:E},"×")]),t("div",ct,[t("form",{onSubmit:F(X,["prevent"])},[t("div",null,[t("div",vt,[t("div",pt,[t("div",mt,[t("div",_t,[e[13]||(e[13]=t("label",{class:"etiqueta"},"Fecha de Inicio",-1)),y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.start_date=a),type:"date",class:v(["entrada",{"is-invalid":l.value.start_date}]),placeholder:"Fecha de Inicio"},null,2),[[S,s.value.start_date]]),l.value.start_date?(r(),n("div",ft,i(l.value.start_date),1)):c("",!0)]),t("div",yt,[e[14]||(e[14]=t("label",{class:"etiqueta"},"Fecha de Fin",-1)),y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.end_date=a),type:"date",class:v(["entrada",{"is-invalid":l.value.end_date}]),placeholder:"Fecha de Fin"},null,2),[[S,s.value.end_date]]),l.value.end_date?(r(),n("div",ht,i(l.value.end_date),1)):c("",!0)]),t("div",bt,[e[15]||(e[15]=t("label",{class:"etiqueta"},"Monto Mensual (COP)",-1)),y(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.monthly_amount=a),type:"number",class:v(["entrada",{"is-invalid":l.value.monthly_amount}]),placeholder:"Monto Mensual"},null,2),[[S,s.value.monthly_amount]]),l.value.monthly_amount?(r(),n("div",gt,i(l.value.monthly_amount),1)):c("",!0)]),t("div",Ct,[e[16]||(e[16]=t("label",{class:"etiqueta"},"Depósito (COP)",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.deposit_amount=a),type:"number",class:v(["entrada",{"is-invalid":l.value.deposit_amount}]),placeholder:"Depósito"},null,2),[[S,s.value.deposit_amount]]),l.value.deposit_amount?(r(),n("div",kt,i(l.value.deposit_amount),1)):c("",!0)]),t("div",wt,[e[18]||(e[18]=t("label",{class:"etiqueta"},"Solicitud de Arrendamiento",-1)),y(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.tenant_application_id=a),class:v(["entrada",{"is-invalid":l.value.tenant_application_id}])},[e[17]||(e[17]=t("option",{value:"",disabled:"",selected:""},"Seleccionar Solicitud",-1)),(r(!0),n(g,null,C(h.value,a=>(r(),n("option",{key:a.id,value:a.id},i(a.property.sku)+" - "+i(a.financial_responsibles[0].full_name),9,xt))),128))],2),[[P,s.value.tenant_application_id]]),l.value.tenant_application_id?(r(),n("div",Mt,i(l.value.tenant_application_id),1)):c("",!0)]),t("div",Dt,[e[20]||(e[20]=t("label",{class:"etiqueta"},"Inmueble",-1)),y(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.property_id=a),class:v(["entrada",{"is-invalid":l.value.property_id}])},[e[19]||(e[19]=t("option",{value:"",disabled:"",selected:""},"Seleccionar Inmueble",-1)),(r(!0),n(g,null,C(f.value,a=>(r(),n("option",{key:a.id,value:a.id},i(a.sku),9,Et))),128))],2),[[P,s.value.property_id]]),l.value.property_id?(r(),n("div",Ft,i(l.value.property_id),1)):c("",!0)]),t("div",St,[e[21]||(e[21]=t("label",{class:"etiqueta"},"Documento del Contrato (PDF)",-1)),t("input",{type:"file",onChange:W,accept:".pdf",class:v(["entrada",{"is-invalid":l.value.contract_doc}])},null,34),l.value.contract_doc?(r(),n("div",Pt,i(l.value.contract_doc),1)):c("",!0)])])])])]),t("div",At,[t("button",{type:"button",class:"boton-secundario",onClick:E}," Cancelar "),t("button",{type:"submit",class:"boton-primario",disabled:_.value,style:{width:"auto"}},i(_.value?"Creando...":"Crear Contrato"),9,Tt)])],32)])])])):c("",!0),q.value?(r(),n("div",{key:2,class:"modal",onClick:F(R,["self"])},[t("div",qt,[t("div",{class:"modal-header"},[e[22]||(e[22]=t("span",{class:"modal-title"},"Documento del Contrato",-1)),t("button",{class:"close-button",onClick:R},"×")]),t("div",Vt,[t("iframe",{src:V.value,width:"100%",height:"100%",style:{border:"none"}},null,8,Ht)])])])):c("",!0),t("div",It,[t("div",Ot,[e[24]||(e[24]=t("h2",{class:"titulo-seccion",style:{margin:"0"}},"📑 Contratos",-1)),t("button",{class:"boton-primario",onClick:e[6]||(e[6]=a=>T.value=!0),style:{width:"auto"}},e[23]||(e[23]=[t("i",{class:"fas fa-plus",style:{"margin-right":"10px"}},null,-1),st("Crear Contrato ")]))]),t("div",Ut,[t("div",Bt,[t("div",Nt,[y(t("select",{class:"entrada","onUpdate:modelValue":e[7]||(e[7]=a=>x.value=a),style:{"background-color":"#f8f5f0"}},[e[25]||(e[25]=t("option",{value:""},"Todos las Propiedades",-1)),(r(!0),n(g,null,C(f.value,a=>(r(),n("option",{key:a,value:a.sku},i(a.sku),9,$t))),128))],512),[[P,x.value]])]),t("div",Lt,[y(t("select",{class:"entrada","onUpdate:modelValue":e[8]||(e[8]=a=>M.value=a),style:{"background-color":"#f8f5f0"}},[e[26]||(e[26]=t("option",{value:""},"Todos los Estados",-1)),(r(),n(g,null,C(G,a=>t("option",{key:a,value:a},i(a),9,Rt)),64))],512),[[P,M.value]])])])]),t("div",jt,[t("div",zt,[t("table",Qt,[e[29]||(e[29]=t("thead",{style:{"background-color":"#8f754f",color:"white"}},[t("tr",null,[t("th",null,"Inicio"),t("th",null,"Fin"),t("th",null,"Arriendo"),t("th",null,"Depósito"),t("th",null,"Inquilino"),t("th",null,"Inmueble"),t("th",null,"Status"),t("th",null,"Contrato"),t("th",null,"Fecha Creación"),t("th")])],-1)),t("tbody",null,[(r(!0),n(g,null,C(L.value,a=>(r(),n("tr",{key:a.id},[t("td",null,i(H(a.start_date)),1),t("td",null,i(H(a.end_date)),1),t("td",null,i(j(a.monthly_amount)),1),t("td",null,i(j(a.deposit_amount)),1),t("td",null,i(a.user.name),1),t("td",null,i(a.property.sku),1),t("td",null,[t("span",{class:v(["badge",Z(a.status)])},i(a.status),3)]),t("td",null,[a.contract_doc?(r(),n("a",{key:0,onClick:F(w=>Y(a.contract_doc_url),["prevent"])},e[27]||(e[27]=[t("i",{class:"fas fa-file-pdf",style:{color:"black"}},null,-1)]),8,Gt)):c("",!0)]),t("td",null,i(H(a.created_at)),1),t("td",null,[t("i",{class:"fa-solid fa-trash",onClick:w=>J(a.id),style:{cursor:"pointer"}},null,8,Jt)])]))),128)),L.value.length===0?(r(),n("tr",Kt,e[28]||(e[28]=[t("td",{colspan:"10",class:"text-center py-4"},"No hay contratos",-1)]))):c("",!0)])])])]),t("div",Wt,[t("nav",null,[t("ul",Xt,[t("li",{class:v(["page-item",{disabled:b.value===1}])},[t("a",{class:"page-link",onClick:e[9]||(e[9]=a=>I(b.value-1)),href:"#"},e[30]||(e[30]=[t("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(r(!0),n(g,null,C(D.value,a=>(r(),n("li",{class:v(["page-item",{active:b.value===a}]),key:a},[t("a",{class:"page-link",onClick:w=>I(a),href:"#"},i(a),9,Yt)],2))),128)),t("li",{class:v(["page-item",{disabled:b.value===D.value||D.value===0}])},[t("a",{class:"page-link",onClick:e[10]||(e[10]=a=>I(b.value+1)),href:"#"},e[31]||(e[31]=[t("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])]))}},oe=et(Zt,[["__scopeId","data-v-f8458154"]]);export{oe as default};
