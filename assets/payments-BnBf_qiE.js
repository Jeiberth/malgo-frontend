import{_ as q,j as J,r as c,i as K,k as X,x as A,c as a,b as w,d as t,q as tt,F as h,p as y,w as x,g as N,t as n,s as R,n as _,B as et,o as l}from"./index-Dnv4c8ld.js";import{S as p}from"./sweetalert2.esm.all-B0Dix5B2.js";import{b as ot}from"./billPayment-CTqxaOgH.js";const st={class:"container"},at={key:0,class:"position-fixed start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(0, 0, 0, 0.5)","z-index":"1050",top:"0px"}},lt={class:"modal-content",style:{"max-width":"900px"}},nt={class:"modal-body p-4",style:{"overflow-y":"auto"}},rt={class:"row"},it={class:"col-md-6"},dt={class:"seccion",style:{height:"100%","padding-bottom":"0px"}},ut={class:"contenedor-campos",style:{gap:"10px !important"}},ct={style:{"overflow-x":"auto"}},mt={class:"table table-striped custom-border-table",style:{"border-radius":"25px",overflow:"hidden"}},ft={class:"col-md-6"},vt={class:"seccion",style:{height:"100%"}},pt={class:"contenedor-campos",style:{height:"calc(100% - 60px)"}},ht={class:"grupo-campos",style:{height:"100%"}},yt=["src"],gt={class:"modal-footer"},bt=["disabled"],_t={class:"row seccion mainSeccion mt-4"},Mt={class:"col-12 mb-4"},Pt={class:"row"},Ct={class:"col-md-6 mb-3"},kt=["value"],wt={class:"col-md-6 mb-3"},xt=["value"],St={class:"col-12"},Ft={style:{"overflow-x":"auto"}},Lt={class:"table table-bordered table-hover table-striped align-middle text-center custom-big-table",style:{"border-radius":"25px",overflow:"hidden"}},Et=["onClick"],Dt={key:0},Ot={class:"col-12 mt-3"},At={class:"pagination"},Ht=["onClick"],H=10,Tt={__name:"payments",setup($t){const j=new X,g=K(),T=new ot;J(async()=>{b.value=!0,m.value=g.getters.getPayments,m.value.length==0&&await T.getPayments().then(o=>{o&&o.success?(m.value=o.data,g.commit("setPayments",m.value)):p.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{console.log(o),p.fire("Error","Hubo un error, intenta despues.","error")}),S.value=g.getters.getProperties,S.value.length==0&&g.getters.userRole=="admin"&&await j.getAllProperties().then(o=>{o&&o.success?g.commit("setProperties",o.data):p.fire("Error","Hubo un error, intenta de nuevo","error")}).catch(o=>{p.fire("Error","Hubo un error, intenta de nuevo","error")}),b.value=!1});const S=c(),m=c((()=>{const o=[],e=["Confirmado","Pendiente"],r=["Bank Transfer","Credit Card","Cash","PayPal"],s=["FO-APTO-201","SE-APTO-301","FO-PARQ-1","SE-LOC-1"],i=["Agua","Luz","Gas","Arriendo"];for(let d=1;d<=25;d++){const Q=Math.floor(Math.random()*3)+1,O=[];for(let u=0;u<Q;u++)O.push({id:d*10+u,payment_id:d,bill_id:d*10+u,bills:{id:d*10+u,bill_type_id:u+1,property_id:Math.floor(Math.random()*4)+1,start_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-01`,end_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-28`,due_date:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-15`,amount:(Math.random()*1e6+5e5).toFixed(2),status:"paid",property:{id:Math.floor(Math.random()*4)+1,sku:s[Math.floor(Math.random()*s.length)]},bill_type:{id:u+1,name:i[Math.floor(Math.random()*i.length)]}}});o.push({id:d,amount:O.reduce((u,Y)=>u+parseFloat(Y.amount),0).toFixed(2),payment_method:r[Math.floor(Math.random()*r.length)],status:e[Math.floor(Math.random()*2)],payment_cert_url:"https://imgs.search.brave.com/Hm6ZRHFEIbcM43R0RIdfNrrEhO_mZu9dfcwZbuYR1Uc/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9pLmJs/b2dzLmVzL2U4Yjhi/ZC93aGF0c2FwcC1p/bWFnZS0yMDI1LTAx/LTEzLWF0LTEwLjE2/LjE0LWFtLzQ1MF8x/MDAwLmpwZWc",paid_at:`2025-${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}-${String(Math.floor(Math.random()*28)+1).padStart(2,"0")}T${String(Math.floor(Math.random()*12)+1).padStart(2,"0")}:${String(Math.floor(Math.random()*60)).padStart(2,"0")}:00`,verified_at:null,payment_has_bills:O})}return o})()),b=c(!1),M=c(!1),P=c(""),C=c(""),f=c(1),$=A(()=>m.value.filter(o=>{const e=!P.value||o.payment_has_bills.some(s=>bills.property.sku===P.value),r=!C.value||(C.value==="Confirmado"?o.status==="Confirmado":o.status==="Pendiente");return e&&r})),k=A(()=>Math.ceil($.value.length/H)),z=A(()=>{const o=(f.value-1)*H;return $.value.slice(o,o+H)}),B=["Confirmado","Pendiente"],F=c(!1),v=c(null),V=o=>{v.value=o,F.value=!0},L=()=>{F.value=!1,v.value=null},Z=async()=>{M.value=!0,b.value=!0,await T.verifyPayment({id:v.value.id}).then(o=>{if(o&&o.success){const e=m.value.findIndex(r=>r.id===v.value.id);e!==-1&&(m.value[e].status="Confirmado",m.value[e].verified_at=new Date().toISOString()),p.fire("Ã‰xito","El pago fue Confirmado exitosamente.","success")}else p.fire("Error","Hubo un error, intenta despues.","error")}).catch(o=>{console.log(o),p.fire("Error","Hubo un error, intenta despues.","error")}),M.value=!1,b.value=!1},I=o=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(o),E=o=>{if(!o)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit"};return new Date(o).toLocaleDateString("es-CO",e)},U=o=>{if(!o)return"N/A";const e={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};return new Date(o).toLocaleDateString("es-CO",e)},W=o=>({Confirmado:"bg-verified",Pendiente:"bg-pending"})[o],G=o=>{switch(o){case"Agua":return"fa-solid fa-bottle-water";case"Gas":return"fa-solid fa-gas-pump";case"Luz":return"fa-solid fa-bolt";case"Arriendo":return"fa-solid fa-house-user";default:return""}},D=o=>{o>=1&&o<=k.value&&(f.value=o)};return(o,e)=>{const r=et("admin-only");return l(),a("div",st,[b.value?(l(),a("div",at,e[4]||(e[4]=[t("div",{class:"spinner-border text-light",role:"status"},[t("span",{class:"visually-hidden"})],-1)]))):w("",!0),F.value?(l(),a("div",{key:1,class:"modal",onClick:tt(L,["self"])},[t("div",lt,[t("div",{class:"modal-header"},[e[5]||(e[5]=t("span",{class:"modal-title"},"ðŸ“„ Detalles del Pago",-1)),t("button",{class:"close-button",onClick:L},"Ã—")]),t("div",nt,[t("div",rt,[t("div",it,[t("div",dt,[e[12]||(e[12]=t("h3",{class:"titulo-seccion"},"ðŸ“‹ Facturas Pagadas",-1)),t("div",ut,[(l(!0),a(h,null,y(v.value.bills,(s,i)=>(l(),a("div",{key:i,class:"grupo-campos"},[t("div",ct,[t("table",mt,[t("tbody",null,[t("tr",null,[e[6]||(e[6]=t("th",{style:{width:"40%"}},"Nombre",-1)),t("td",null,n(s.bill_type.name),1)]),t("tr",null,[e[7]||(e[7]=t("th",null,"Inmueble",-1)),t("td",null,n(s.property.sku),1)]),t("tr",null,[e[8]||(e[8]=t("th",null,"Desde",-1)),t("td",null,n(E(s.start_date)),1)]),t("tr",null,[e[9]||(e[9]=t("th",null,"Hasta",-1)),t("td",null,n(E(s.end_date)),1)]),t("tr",null,[e[10]||(e[10]=t("th",null,"Vence",-1)),t("td",null,n(E(s.due_date)),1)]),t("tr",null,[e[11]||(e[11]=t("th",null,"Monto",-1)),t("td",null,n(I(s.amount)),1)])])])])]))),128))])])]),t("div",ft,[t("div",vt,[e[13]||(e[13]=t("h3",{class:"titulo-seccion"},"ðŸ“„ Comprobante de Pago",-1)),t("div",pt,[t("div",ht,[t("img",{src:v.value.payment_cert_url,alt:"Comprobante de pago",style:{width:"100%",height:"100%","object-fit":"contain",border:"0px solid #d7b377","border-radius":"15px"}},null,8,yt)])])])])]),t("div",gt,[t("button",{type:"button",class:"boton-secundario",onClick:L}," Cancelar "),v.value.status!=="Confirmado"?x((l(),a("button",{key:0,type:"button",class:"boton-primario",onClick:Z,disabled:M.value,style:{width:"auto"}},[N(n(M.value?"Confirmando...":"Confirmar"),1)],8,bt)),[[r]]):w("",!0)])])])])):w("",!0),t("div",_t,[e[22]||(e[22]=t("div",{class:"col-12"},[t("h2",{class:"titulo-seccion"},"ðŸ’µ Pagos")],-1)),x((l(),a("div",Mt,[t("div",Pt,[t("div",Ct,[x(t("select",{class:"entrada","onUpdate:modelValue":e[0]||(e[0]=s=>P.value=s),style:{"background-color":"#f8f5f0"}},[e[14]||(e[14]=t("option",{value:""},"Todas las Propiedades",-1)),(l(!0),a(h,null,y(S.value,s=>(l(),a("option",{key:s,value:s.sku},n(s.sku),9,kt))),128))],512),[[R,P.value]])]),t("div",wt,[x(t("select",{class:"entrada","onUpdate:modelValue":e[1]||(e[1]=s=>C.value=s),style:{"background-color":"#f8f5f0"}},[e[15]||(e[15]=t("option",{value:""},"Todos los Estados",-1)),(l(),a(h,null,y(B,s=>t("option",{key:s,value:s},n(s),9,xt)),64))],512),[[R,C.value]])])])])),[[r]]),t("div",St,[t("div",Ft,[t("table",Lt,[e[19]||(e[19]=t("thead",{style:{"background-color":"#8f754f",color:"white"}},[t("tr",null,[t("th",null,"PagÃ³"),t("th",null,"Monto"),t("th",null,"MÃ©todo de Pago"),t("th",null,"Estado"),t("th",null,"Pagado el"),t("th")])],-1)),t("tbody",null,[(l(!0),a(h,null,y(z.value,s=>(l(),a("tr",{key:s.id},[t("td",null,[(l(!0),a(h,null,y(s.bills,(i,d)=>(l(),a("div",{key:d},[N(n(i.property.sku)+" ",1),t("i",{class:_(G(i.bill_type.name))},null,2),e[16]||(e[16]=t("br",null,null,-1))]))),128))]),t("td",null,n(I(s.amount)),1),t("td",null,n(s.payment_method),1),t("td",null,[t("span",{class:_(["badge",W(s.status)])},n(s.status==="Confirmado"?"Confirmado":"Pendiente"),3)]),t("td",null,n(U(s.paid_at)),1),t("td",null,[t("button",{class:"btn btn-sm",onClick:i=>V(s),style:{background:"none",border:"none"}},e[17]||(e[17]=[t("i",{class:"fas fa-info-circle",style:{color:"#8f754f","font-size":"1.2rem"}},null,-1)]),8,Et)])]))),128)),z.value.length===0?(l(),a("tr",Dt,e[18]||(e[18]=[t("td",{colspan:"6",class:"text-center py-4"},"No hay pagos todavia",-1)]))):w("",!0)])])])]),t("div",Ot,[t("nav",null,[t("ul",At,[t("li",{class:_(["page-item",{disabled:f.value===1}])},[t("a",{class:"page-link",onClick:e[2]||(e[2]=s=>D(f.value-1)),href:"#"},e[20]||(e[20]=[t("i",{class:"fa fa-arrow-left"},null,-1)]))],2),(l(!0),a(h,null,y(k.value,s=>(l(),a("li",{class:_(["page-item",{active:f.value===s}]),key:s},[t("a",{class:"page-link",onClick:i=>D(s),href:"#"},n(s),9,Ht)],2))),128)),t("li",{class:_(["page-item",{disabled:f.value===k.value||k.value===0}])},[t("a",{class:"page-link",onClick:e[3]||(e[3]=s=>D(f.value+1)),href:"#"},e[21]||(e[21]=[t("i",{class:"fa fa-arrow-right"},null,-1)]))],2)])])])])])}}},jt=q(Tt,[["__scopeId","data-v-5b85f6c8"]]);export{jt as default};
